<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Resume - Developer Resume Builder</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
        }
        .main-container {
            padding: 2rem 1rem;
        }
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #ffffff;
            border-bottom: 1px solid #f1f1f1;
            padding: 1.2rem 1.5rem;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 12px 12px 0 0 !important;
        }
        .card-body {
            padding: 1.5rem;
        }
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 0.95rem;
            border: 1px solid #dee2e6;
            transition: all 0.3s;
        }
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.25rem rgba(74, 107, 255, 0.25);
            border-color: #4a6bff;
        }
        .form-label {
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
        }
        .btn-primary {
            background-color: #4a6bff;
            border-color: #4a6bff;
            padding: 10px 20px;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .btn-primary:hover {
            background-color: #3a5aff;
            border-color: #3a5aff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 107, 255, 0.4);
        }
        .btn-outline-primary {
            color: #4a6bff;
            border-color: #4a6bff;
            padding: 10px 20px;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .btn-outline-primary:hover {
            background-color: #4a6bff;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 107, 255, 0.4);
        }
        .btn-danger {
            background-color: #ff4a6b;
            border-color: #ff4a6b;
            padding: 10px 20px;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .btn-danger:hover {
            background-color: #ff3a5a;
            border-color: #ff3a5a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 74, 107, 0.4);
        }
        .section-title {
            font-weight: 600;
            margin-bottom: 1.5rem;
            font-size: 1.4rem;
            color: #2c3e50;
        }
        .dynamic-form {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            border: 1px dashed #dee2e6;
        }
        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f8d7da;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #dc3545;
            transition: all 0.2s;
        }
        .remove-btn:hover {
            background-color: #dc3545;
            color: white;
        }
        .add-item-btn {
            background-color: #e8f0fe;
            border: 1px dashed #4a6bff;
            color: #4a6bff;
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .add-item-btn:hover {
            background-color: #d8e6fd;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 107, 255, 0.2);
        }
        .navbar {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        .navbar-brand {
            font-weight: 700;
            color: #4a6bff;
        }
        .navbar-nav .nav-link {
            font-weight: 500;
            color: #495057;
            padding: 0.8rem 1rem;
            transition: all 0.3s;
        }
        .navbar-nav .nav-link:hover, .navbar-nav .nav-link.active {
            color: #4a6bff;
        }
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #4a6bff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 10px;
        }
        .user-dropdown {
            font-weight: 500;
        }
        .dropdown-menu {
            border: none;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        .dropdown-item {
            padding: 10px 15px;
            font-weight: 500;
            transition: all 0.2s;
        }
        .dropdown-item:hover {
            background-color: #f1f4ff;
            color: #4a6bff;
        }
        .action-bar {
            position: sticky;
            bottom: 0;
            background-color: white;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.08);
            padding: 1rem 0;
            z-index: 1000;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="/dashboard">Developer Resume</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/resumes/create">Create Resume</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center" sec:authorize="isAuthenticated()">
                    <div class="dropdown">
                        <a class="d-flex align-items-center text-decoration-none user-dropdown dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="avatar">
                                <span th:text="${#authentication.name.substring(0, 1).toUpperCase()}">U</span>
                            </div>
                            <span th:text="${#authentication.name}">Username</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="/dashboard"><i class="bi bi-speedometer2 me-2"></i>Dashboard</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form th:action="@{/logout}" method="post">
                                    <button type="submit" class="dropdown-item"><i class="bi bi-box-arrow-right me-2"></i>Logout</button>
                                </form>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="section-title mb-0">Edit Resume</h1>
            <div class="btn-group">
                <a th:href="@{/resumes/{id}(id=${resume.id})}" class="btn btn-outline-primary">
                    <i class="bi bi-eye me-2"></i>View
                </a>
                <a th:href="@{/resumes/{id}/download(id=${resume.id})}" class="btn btn-outline-primary">
                    <i class="bi bi-download me-2"></i>Download PDF
                </a>
            </div>
        </div>
        
        <form th:action="@{/resumes/{id}/edit(id=${resume.id})}" th:object="${resume}" method="post" id="resumeForm">
            <input type="hidden" th:field="*{id}">
            
            <!-- Basic Information Card -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-file-earmark-person me-2"></i>Basic Information
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="title" class="form-label">Resume Title *</label>
                            <input type="text" class="form-control" id="title" th:field="*{title}" 
                                   th:classappend="${#fields.hasErrors('title')} ? 'is-invalid' : ''" 
                                   placeholder="e.g., Senior Java Developer Resume" required>
                            <div class="invalid-feedback" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">
                                Please provide a resume title.
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="summary" class="form-label">Professional Summary</label>
                        <textarea class="form-control" id="summary" th:field="*{summary}" rows="4" 
                                  placeholder="Write a compelling summary of your professional experience, skills, and career goals..."></textarea>
                    </div>
                </div>
            </div>
            
            <!-- Experience Section -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-briefcase me-2"></i>Work Experience
                </div>
                <div class="card-body">
                    <div id="experienceForms">
                        <div class="dynamic-form" th:each="experience, expStat : *{experiences}">
                            <button type="button" class="remove-btn" onclick="removeForm(this)">
                                <i class="bi bi-x"></i>
                            </button>
                            <input type="hidden" th:field="*{experiences[__${expStat.index}__].id}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Company Name *</label>
                                    <input type="text" class="form-control" th:field="*{experiences[__${expStat.index}__].companyName}" 
                                           placeholder="e.g., Google" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Job Title *</label>
                                    <input type="text" class="form-control" th:field="*{experiences[__${expStat.index}__].jobTitle}" 
                                           placeholder="e.g., Senior Software Engineer" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-5">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" class="form-control" th:field="*{experiences[__${expStat.index}__].startDate}">
                                </div>
                                <div class="col-md-5">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control" th:field="*{experiences[__${expStat.index}__].endDate}" 
                                           th:disabled="*{experiences[__${expStat.index}__].currentlyWorking}">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" th:field="*{experiences[__${expStat.index}__].currentlyWorking}" 
                                               th:id="'currentlyWorking' + ${expStat.index}" onchange="toggleEndDate(this, '${expStat.index}')">
                                        <label class="form-check-label" th:for="'currentlyWorking' + ${expStat.index}" />
                                            Present
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" th:field="*{experiences[__${expStat.index}__].description}" rows="3" 
                                          placeholder="Describe your responsibilities, achievements, and the technologies you worked with..."></textarea>
                            </div>
                            
                            <!-- Projects within Experience -->
                            <div class="mt-4 mb-2">
                                <h6 class="fw-bold">Projects</h6>
                                <div class="projects-container">
                                    <div class="project-form border-start border-4 border-primary ps-3 py-2 mb-3" 
                                         th:each="project, projStat : *{experiences[__${expStat.index}__].projects}">
                                        <input type="hidden" th:field="*{experiences[__${expStat.index}__].projects[__${projStat.index}__].id}">
                                        <div class="row mb-2">
                                            <div class="col-md-6">
                                                <label class="form-label">Project Name</label>
                                                <input type="text" class="form-control" 
                                                       th:field="*{experiences[__${expStat.index}__].projects[__${projStat.index}__].name}" 
                                                       placeholder="e.g., E-commerce Platform">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Technologies Used</label>
                                                <input type="text" class="form-control" 
                                                       th:field="*{experiences[__${expStat.index}__].projects[__${projStat.index}__].technologies}" 
                                                       placeholder="e.g., Java, Spring Boot, React">
                                            </div>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label">Description</label>
                                            <textarea class="form-control" 
                                                      th:field="*{experiences[__${expStat.index}__].projects[__${projStat.index}__].description}" 
                                                      rows="2" placeholder="Brief description of the project..."></textarea>
                                        </div>
                                        <div class="mb-2">
                                            <label class="form-label">Project URL</label>
                                            <input type="url" class="form-control" 
                                                   th:field="*{experiences[__${expStat.index}__].projects[__${projStat.index}__].url}" 
                                                   placeholder="e.g., https://github.com/username/project">
                                        </div>
                                        <button type="button" class="btn btn-sm btn-outline-danger mt-2" 
                                                onclick="removeProject(this, '${expStat.index}')">
                                            <i class="bi bi-trash me-1"></i>Remove Project
                                        </button>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary mt-2" 
                                        th:onclick="'addProject(' + ${expStat.index} + ')'">
                                    <i class="bi bi-plus-circle me-1"></i>Add Project
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn mt-3" onclick="addExperience()">
                        <i class="bi bi-plus-circle me-2"></i>Add Work Experience
                    </button>
                </div>
            </div>
            
            <!-- Education Section -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-mortarboard me-2"></i>Education
                </div>
                <div class="card-body">
                    <div id="educationForms">
                        <div class="dynamic-form" th:each="education, eduStat : *{educations}">
                            <button type="button" class="remove-btn" onclick="removeForm(this)">
                                <i class="bi bi-x"></i>
                            </button>
                            <input type="hidden" th:field="*{educations[__${eduStat.index}__].id}">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Institution *</label>
                                    <input type="text" class="form-control" th:field="*{educations[__${eduStat.index}__].institution}" 
                                           placeholder="e.g., University of California, Berkeley" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Degree *</label>
                                    <input type="text" class="form-control" th:field="*{educations[__${eduStat.index}__].degree}" 
                                           placeholder="e.g., Bachelor of Science" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Field of Study</label>
                                    <input type="text" class="form-control" th:field="*{educations[__${eduStat.index}__].fieldOfStudy}" 
                                           placeholder="e.g., Computer Science">
                                </div>
                                <div class="col-md-6">
<!--                                    <label class="form-label">Grade / GPA</label>-->
<!--                                    <input type="text" class="form-control" th:field="*{educations[__${eduStat.index}__].grade}" -->
<!--                                           placeholder="e.g., 3.8/4.0">-->
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-5">
                                    <label class="form-label">Start Date</label>
                                    <input type="date" class="form-control" th:field="*{educations[__${eduStat.index}__].startDate}">
                                </div>
                                <div class="col-md-5">
                                    <label class="form-label">End Date</label>
                                    <input type="date" class="form-control" th:field="*{educations[__${eduStat.index}__].endDate}"
                                           th:disabled="*{educations[__${eduStat.index}__].currentlyStudying}">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" th:field="*{educations[__${eduStat.index}__].currentlyStudying}" 
                                               th:id="'currentlyStudying' + ${eduStat.index}" onchange="toggleEducationEndDate(this, '${eduStat.index}')">
                                        <label class="form-check-label" th:for="'currentlyStudying' + ${eduStat.index}">
                                            Present
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" th:field="*{educations[__${eduStat.index}__].description}" rows="2" 
                                          placeholder="Relevant coursework, achievements, activities..."></textarea>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn mt-3" onclick="addEducation()">
                        <i class="bi bi-plus-circle me-2"></i>Add Education
                    </button>
                </div>
            </div>
            
            <!-- Skills Section -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-tools me-2"></i>Skills
                </div>
                <div class="card-body">
                    <div id="skillForms">
                        <div class="dynamic-form" th:each="skill, skillStat : *{skills}">
                            <button type="button" class="remove-btn" onclick="removeForm(this)">
                                <i class="bi bi-x"></i>
                            </button>
                            <input type="hidden" th:field="*{skills[__${skillStat.index}__].id}">
                            <div class="row">
                                <div class="col-md-8">
                                    <label class="form-label">Skill Name *</label>
                                    <input type="text" class="form-control" th:field="*{skills[__${skillStat.index}__].name}" 
                                           placeholder="e.g., Java, React, Docker" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Proficiency Level</label>
                                    <select class="form-select" th:field="*{skills[__${skillStat.index}__].proficiencyLevel}">
                                        <option value="">-- Select Level --</option>
                                        <option value="1">Beginner</option>
                                        <option value="2">Basic</option>
                                        <option value="3">Intermediate</option>
                                        <option value="4">Advanced</option>
                                        <option value="5">Expert</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="add-item-btn mt-3" onclick="addSkill()">
                        <i class="bi bi-plus-circle me-2"></i>Add Skill
                    </button>
                </div>
            </div>
            
            <!-- Additional Sections Card -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-plus-circle me-2"></i>Additional Sections
                </div>
                <div class="card-body">
                    <ul class="nav nav-tabs" id="additionalTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="certifications-tab" data-bs-toggle="tab" data-bs-target="#certifications" 
                                    type="button" role="tab">Certifications</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="languages-tab" data-bs-toggle="tab" data-bs-target="#languages" 
                                    type="button" role="tab">Languages</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="hobbies-tab" data-bs-toggle="tab" data-bs-target="#hobbies" 
                                    type="button" role="tab">Interests & Hobbies</button>
                        </li>
                    </ul>
                    <div class="tab-content p-3" id="additionalTabsContent">
                        <!-- Certifications Tab -->
                        <div class="tab-pane fade show active" id="certifications" role="tabpanel">
                            <div id="certificationForms">
                                <div class="dynamic-form" th:each="certification, certStat : *{certifications}">
                                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                                        <i class="bi bi-x"></i>
                                    </button>
                                    <input type="hidden" th:field="*{certifications[__${certStat.index}__].id}">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Certification Name *</label>
                                            <input type="text" class="form-control" th:field="*{certifications[__${certStat.index}__].name}" 
                                                   placeholder="e.g., AWS Certified Solutions Architect" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Issuing Organization</label>
                                            <input type="text" class="form-control" th:field="*{certifications[__${certStat.index}__].issuingOrganization}" 
                                                   placeholder="e.g., Amazon Web Services">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Issue Date</label>
                                            <input type="date" class="form-control" th:field="*{certifications[__${certStat.index}__].issueDate}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Expiration Date</label>
                                            <input type="date" class="form-control" th:field="*{certifications[__${certStat.index}__].expirationDate}">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Credential ID</label>
                                            <input type="text" class="form-control" th:field="*{certifications[__${certStat.index}__].credentialId}" 
                                                   placeholder="e.g., ABC123XYZ">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Credential URL</label>
                                            <input type="url" class="form-control" th:field="*{certifications[__${certStat.index}__].credentialUrl}" 
                                                   placeholder="e.g., https://www.credential.net/...">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-item-btn mt-3" onclick="addCertification()">
                                <i class="bi bi-plus-circle me-2"></i>Add Certification
                            </button>
                        </div>
                        
                        <!-- Languages Tab -->
                        <div class="tab-pane fade" id="languages" role="tabpanel">
                            <div id="languageForms">
                                <div class="dynamic-form" th:each="language, langStat : *{languages}">
                                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                                        <i class="bi bi-x"></i>
                                    </button>
                                    <input type="hidden" th:field="*{languages[__${langStat.index}__].id}">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Language *</label>
                                            <input type="text" class="form-control" th:field="*{languages[__${langStat.index}__].name}" 
                                                   placeholder="e.g., English, Spanish, French" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Proficiency Level</label>
                                            <select class="form-select" th:field="*{languages[__${langStat.index}__].proficiencyLevel}">
                                                <option value="">-- Select Level --</option>
                                                <option value="Native">Native</option>
                                                <option value="Fluent">Fluent</option>
                                                <option value="Advanced">Advanced</option>
                                                <option value="Intermediate">Intermediate</option>
                                                <option value="Basic">Basic</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-item-btn mt-3" onclick="addLanguage()">
                                <i class="bi bi-plus-circle me-2"></i>Add Language
                            </button>
                        </div>
                        
                        <!-- Hobbies Tab -->
                        <div class="tab-pane fade" id="hobbies" role="tabpanel">
                            <div id="hobbyForms">
                                <div class="dynamic-form" th:each="hobby, hobbyStat : *{hobbies}">
                                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                                        <i class="bi bi-x"></i>
                                    </button>
                                    <input type="hidden" th:field="*{hobbies[__${hobbyStat.index}__].id}">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Hobby/Interest *</label>
                                            <input type="text" class="form-control" th:field="*{hobbies[__${hobbyStat.index}__].name}" 
                                                   placeholder="e.g., Photography, Open-source contribution" required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Description</label>
                                            <input type="text" class="form-control" th:field="*{hobbies[__${hobbyStat.index}__].description}" 
                                                   placeholder="Brief description (optional)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="add-item-btn mt-3" onclick="addHobby()">
                                <i class="bi bi-plus-circle me-2"></i>Add Hobby/Interest
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Submit Button -->
            <div class="action-bar">
                <div class="container">
                    <div class="d-flex justify-content-between">
                        <div>
                            <a th:href="@{/resumes/{id}(id=${resume.id})}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-lg me-2"></i>Cancel
                            </a>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-primary px-5">
                                <i class="bi bi-save me-2"></i>Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Same JavaScript functions as in create.html plus these specific functions for edit page

        function toggleEndDate(checkbox, index) {
            const endDateInput = document.querySelector(`input[name="experiences[${index}].endDate"]`);
            endDateInput.disabled = checkbox.checked;
            if (checkbox.checked) {
                endDateInput.value = '';
            }
        }

        function toggleEducationEndDate(checkbox, index) {
            const endDateInput = document.querySelector(`input[name="educations[${index}].endDate"]`);
            endDateInput.disabled = checkbox.checked;
            if (checkbox.checked) {
                endDateInput.value = '';
            }
        }

        // Initialize with default forms if none exist
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize "Present" checkboxes for experience
            document.querySelectorAll('[id^="currentlyWorking"]').forEach(function(checkbox) {
                const index = checkbox.id.replace('currentlyWorking', '');
                if (checkbox.checked) {
                    const endDateInput = document.querySelector(`input[name="experiences[${index}].endDate"]`);
                    if (endDateInput) {
                        endDateInput.disabled = true;
                    }
                }
            });

            // Initialize "Present" checkboxes for education
            document.querySelectorAll('[id^="currentlyStudying"]').forEach(function(checkbox) {
                const index = checkbox.id.replace('currentlyStudying', '');
                if (checkbox.checked) {
                    const endDateInput = document.querySelector(`input[name="educations[${index}].endDate"]`);
                    if (endDateInput) {
                        endDateInput.disabled = true;
                    }
                }
            });
        });

        // Include all the same functions from create.html (addExperience, addEducation, etc.)
        // Dynamic form functionality
        function addExperience() {
            const container = document.getElementById('experienceForms');
            const index = container.children.length;

            const template = `
                <div class="dynamic-form">
                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                        <i class="bi bi-x"></i>
                    </button>
                    <input type="hidden" name="experiences[${index}].id" value="">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Company Name *</label>
                            <input type="text" class="form-control" name="experiences[${index}].companyName"
                                   placeholder="e.g., Google" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Job Title *</label>
                            <input type="text" class="form-control" name="experiences[${index}].jobTitle"
                                   placeholder="e.g., Senior Software Engineer" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-5">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-control" name="experiences[${index}].startDate">
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-control" name="experiences[${index}].endDate">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="experiences[${index}].currentlyWorking"
                                       id="currentlyWorking${index}" onchange="toggleEndDate(this, ${index})">
                                <label class="form-check-label" for="currentlyWorking${index}">
                                    Present
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="experiences[${index}].description" rows="3"
                                  placeholder="Describe your responsibilities, achievements, and the technologies you worked with..."></textarea>
                    </div>

                    <div class="mt-4 mb-2">
                        <h6 class="fw-bold">Projects</h6>
                        <div class="projects-container">
                        </div>
                        <button type="button" class="btn btn-sm btn-outline-primary mt-2"
                                onclick="addProject(${index})">
                            <i class="bi bi-plus-circle me-1"></i>Add Project
                        </button>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function addEducation() {
            const container = document.getElementById('educationForms');
            const index = container.children.length;

            const template = `
                <div class="dynamic-form">
                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                        <i class="bi bi-x"></i>
                    </button>
                    <input type="hidden" name="educations[${index}].id" value="">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Institution *</label>
                            <input type="text" class="form-control" name="educations[${index}].institution"
                                   placeholder="e.g., University of California, Berkeley" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Degree *</label>
                            <input type="text" class="form-control" name="educations[${index}].degree"
                                   placeholder="e.g., Bachelor of Science" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Field of Study</label>
                            <input type="text" class="form-control" name="educations[${index}].fieldOfStudy"
                                   placeholder="e.g., Computer Science">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Grade / GPA</label>
                            <input type="text" class="form-control" name="educations[${index}].grade"
                                   placeholder="e.g., 3.8/4.0">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-5">
                            <label class="form-label">Start Date</label>
                            <input type="date" class="form-control" name="educations[${index}].startDate">
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">End Date</label>
                            <input type="date" class="form-control" name="educations[${index}].endDate">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" name="educations[${index}].currentlyStudying"
                                       id="currentlyStudying${index}" onchange="toggleEducationEndDate(this, ${index})">
                                <label class="form-check-label" for="currentlyStudying${index}">
                                    Present
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="educations[${index}].description" rows="2"
                                  placeholder="Relevant coursework, achievements, activities..."></textarea>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function addSkill() {
            const container = document.getElementById('skillForms');
            const index = container.children.length;

            const template = `
                <div class="dynamic-form">
                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                        <i class="bi bi-x"></i>
                    </button>
                    <input type="hidden" name="skills[${index}].id" value="">
                    <div class="row">
                        <div class="col-md-8">
                            <label class="form-label">Skill Name *</label>
                            <input type="text" class="form-control" name="skills[${index}].name"
                                   placeholder="e.g., Java, React, Docker" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Proficiency Level</label>
                            <select class="form-select" name="skills[${index}].proficiencyLevel">
                                <option value="">-- Select Level --</option>
                                <option value="1">Beginner</option>
                                <option value="2">Basic</option>
                                <option value="3">Intermediate</option>
                                <option value="4">Advanced</option>
                                <option value="5">Expert</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function addCertification() {
            const container = document.getElementById('certificationForms');
            const index = container.children.length;

            const template = `
                <div class="dynamic-form">
                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                        <i class="bi bi-x"></i>
                    </button>
                    <input type="hidden" name="certifications[${index}].id" value="">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Certification Name *</label>
                            <input type="text" class="form-control" name="certifications[${index}].name"
                                   placeholder="e.g., AWS Certified Solutions Architect" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Issuing Organization</label>
                            <input type="text" class="form-control" name="certifications[${index}].issuingOrganization"
                                   placeholder="e.g., Amazon Web Services">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Issue Date</label>
                            <input type="date" class="form-control" name="certifications[${index}].issueDate">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Expiration Date</label>
                            <input type="date" class="form-control" name="certifications[${index}].expirationDate">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Credential ID</label>
                            <input type="text" class="form-control" name="certifications[${index}].credentialId"
                                   placeholder="e.g., ABC123XYZ">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Credential URL</label>
                            <input type="url" class="form-control" name="certifications[${index}].credentialUrl"
                                   placeholder="e.g., https://www.credential.net/...">
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function addLanguage() {
            const container = document.getElementById('languageForms');
            const index = container.children.length;

            const template = `
                <div class="dynamic-form">
                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                        <i class="bi bi-x"></i>
                    </button>
                    <input type="hidden" name="languages[${index}].id" value="">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Language *</label>
                            <input type="text" class="form-control" name="languages[${index}].name"
                                   placeholder="e.g., English, Spanish, French" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Proficiency Level</label>
                            <select class="form-select" name="languages[${index}].proficiencyLevel">
                                <option value="">-- Select Level --</option>
                                <option value="Native">Native</option>
                                <option value="Fluent">Fluent</option>
                                <option value="Advanced">Advanced</option>
                                <option value="Intermediate">Intermediate</option>
                                <option value="Basic">Basic</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function addHobby() {
            const container = document.getElementById('hobbyForms');
            const index = container.children.length;

            const template = `
                <div class="dynamic-form">
                    <button type="button" class="remove-btn" onclick="removeForm(this)">
                        <i class="bi bi-x"></i>
                    </button>
                    <input type="hidden" name="hobbies[${index}].id" value="">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Hobby/Interest *</label>
                            <input type="text" class="form-control" name="hobbies[${index}].name"
                                   placeholder="e.g., Photography, Open-source contribution" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Description</label>
                            <input type="text" class="form-control" name="hobbies[${index}].description"
                                   placeholder="Brief description (optional)">
                        </div>
                    </div>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function addProject(expIndex) {
            const container = document.querySelector(`#experienceForms .dynamic-form:nth-child(${expIndex + 1}) .projects-container`);
            const index = container.children.length;

            const template = `
                <div class="project-form border-start border-4 border-primary ps-3 py-2 mb-3">
                    <input type="hidden" name="experiences[${expIndex}].projects[${index}].id" value="">
                    <div class="row mb-2">
                        <div class="col-md-6">
                            <label class="form-label">Project Name</label>
                            <input type="text" class="form-control"
                                   name="experiences[${expIndex}].projects[${index}].name"
                                   placeholder="e.g., E-commerce Platform">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Technologies Used</label>
                            <input type="text" class="form-control"
                                   name="experiences[${expIndex}].projects[${index}].technologies"
                                   placeholder="e.g., Java, Spring Boot, React">
                        </div>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Description</label>
                        <textarea class="form-control"
                                  name="experiences[${expIndex}].projects[${index}].description"
                                  rows="2" placeholder="Brief description of the project..."></textarea>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">Project URL</label>
                        <input type="url" class="form-control"
                               name="experiences[${expIndex}].projects[${index}].url"
                               placeholder="e.g., https://github.com/username/project">
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger mt-2"
                            onclick="removeProject(this, ${expIndex})">
                        <i class="bi bi-trash me-1"></i>Remove Project
                    </button>
                </div>
            `;

            container.insertAdjacentHTML('beforeend', template);
        }

        function removeForm(button) {
            const form = button.closest('.dynamic-form');
            form.remove();
        }

        function removeProject(button, expIndex) {
            const projectForm = button.closest('.project-form');
            projectForm.remove();
        }
    </script>
</body>
</html>
